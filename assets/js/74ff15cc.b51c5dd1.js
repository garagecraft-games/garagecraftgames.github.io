"use strict";(self.webpackChunkgaragecraft_games=self.webpackChunkgaragecraft_games||[]).push([[8550],{1316:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>t,toc:()=>h});var t=n(7192),a=n(4848),i=n(8453);const r={title:"Phase/Pass Architecture: Evolution of the Game Loop",description:"A follow-up to the game loop architecture post, introducing the refined Phase/Pass structure. This post explores how helios now organizes the game loop into phases with granular passes, enabling fine-grained control over event propagation and command execution timing.",date:"2026-02-10",slug:"/2026-02-10-phase-pass-architecture/",tags:["devlog","helios","architecture","game-loop","events","commands","phase-pass","double-buffering","data-oriented-design"],keywords:["cpp","game engine","architecture","command pattern","event bus","phase","pass","commit point","determinism","frame lifecycle"],authors:["thorstensuckow"]},o=void 0,l={authorsImageUrls:[void 0]},h=[{value:"From Flat to Hierarchical: The Phase/Pass Model",id:"from-flat-to-hierarchical-the-phasepass-model",level:2},{value:"Phases and Passes",id:"phases-and-passes",level:2},{value:"Three Event Buses - Three Scopes",id:"three-event-buses---three-scopes",level:2},{value:"Why Three Buses?",id:"why-three-buses",level:3},{value:"Fine-Grained Control with Commoit-Points",id:"fine-grained-control-with-commoit-points",level:2},{value:"The Refined Phase Commit",id:"the-refined-phase-commit",level:2},{value:"Complete Frame Execution",id:"complete-frame-execution",level:2},{value:"Practical Example: Spawning a Projectile",id:"practical-example-spawning-a-projectile",level:2},{value:"Key Improvements Over the Original Design",id:"key-improvements-over-the-original-design",level:2},{value:"When to Use What",id:"when-to-use-what",level:2},{value:"Related works",id:"related-works",level:2},{value:"Looking Forward",id:"looking-forward",level:2}];function d(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s.p,{children:["In my ",(0,a.jsx)(s.a,{href:"/devlog/2026-01-05-high-level-overview-of-the-game-loop-architecture/",children:"previous post"}),", I outlined the high-level separation between Commands and Events in helios, along with the basic double-buffered EventBus and CommandBuffer concepts. Since then, I've iterated significantly on the architecture, and I'm excited to share what has emerged: A ",(0,a.jsx)(s.strong,{children:"Phase/Pass structure"})," that provides much finer control over when events become visible and when commands execute."]}),"\n",(0,a.jsx)(s.p,{children:"The original design worked well for simple scenarios, but as I added more systems, like spawn scheduling, collision response and scene synchronization, I ran into timing issues: Events pushed in one system weren't visible to systems that needed to react within the same logical block of processing. So I broke the monolithic frame into hierarchical units."}),"\n",(0,a.jsx)(s.h2,{id:"from-flat-to-hierarchical-the-phasepass-model",children:"From Flat to Hierarchical: The Phase/Pass Model"}),"\n",(0,a.jsx)(s.p,{children:"The original architecture treated the frame as a sequence of steps:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-cpp",children:"// Old approach\nEventBus.swapBuffers();\nEventBus.dispatch();\nCommandBuffer.flush();\nManagerRepository.flush();\nImmediateBus.dispatch();\n// ... systems update ...\n"})}),"\n",(0,a.jsx)(s.p,{children:"This worked well in simple scenarios, but forced all events to wait until the next frame to be readable. That did not work, especially for systems that needed to communicate in the same logical phase. The new game loop architecture introduces a two-level hierarchy:"}),"\n",(0,a.jsx)(s.h2,{id:"phases-and-passes",children:"Phases and Passes"}),"\n",(0,a.jsxs)(s.p,{children:["The game loop is now organized into ",(0,a.jsx)(s.strong,{children:"Phases"})," and ",(0,a.jsx)(s.strong,{children:"Passes"}),":"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                            FRAME                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                     \u2502\n\u2502  PRE PHASE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Pass 1 (Input) \u2500\u2500> Pass 2 (Commit) \u2500\u2500> Pass 3                    \u2502\n\u2502                            \u2502                                        \u2502\n\u2502                     [Pass Commit Point]                             \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Phase Commit    \u2502\n\u2502                                                                     \u2502\n\u2502  MAIN PHASE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Pass 1 (Gameplay) \u2500\u2500> Pass 2 (Collision) \u2500\u2500> Pass 3 (AI)         \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Phase Commit    \u2502\n\u2502                                                                     \u2502\n\u2502  POST PHASE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Pass 1 (Scene Sync) \u2500\u2500> Pass 2 (Cleanup)                         \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Phase Commit    \u2502\n\u2502                                                                     \u2502\n\u2502                          RENDER                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Phases"})," are divided into three major segments ",(0,a.jsx)(s.strong,{children:"Pre"}),", ",(0,a.jsx)(s.strong,{children:"Main"}),", ",(0,a.jsx)(s.strong,{children:"Post"}),") with distinct responsibilities.\nAfter each phase, a ",(0,a.jsx)(s.strong,{children:"Phase Commit"})," occurs: phase events become readable, pass events are cleared, commands are flushed, and managers process their queues."]}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Passes"})," are sub-units within phases. A pass can optionally have a ",(0,a.jsx)(s.strong,{children:"Commit Point"}),", making pass-level events readable in subsequent passes of the same phase."]}),"\n",(0,a.jsx)(s.h2,{id:"three-event-buses---three-scopes",children:"Three Event Buses - Three Scopes"}),"\n",(0,a.jsx)(s.p,{children:"The single EventBus has evolved into three distinct buses, each with a different visibility scope:"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Event Bus"}),(0,a.jsx)(s.th,{children:"Push Method"}),(0,a.jsx)(s.th,{children:"Read Method"}),(0,a.jsx)(s.th,{children:"Visibility"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Pass"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"pushPass<E>()"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"readPass<E>()"})}),(0,a.jsx)(s.td,{children:"Subsequent passes (same phase)"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Phase"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"pushPhase<E>()"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"readPhase<E>()"})}),(0,a.jsx)(s.td,{children:"Next phase"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Frame"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"pushFrame<E>()"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"readFrame<E>()"})}),(0,a.jsx)(s.td,{children:"Next frame"})]})]})]}),"\n",(0,a.jsxs)(s.p,{children:["All buses remain double-buffered, but the ",(0,a.jsx)(s.strong,{children:"swap timing"})," is now tied to the appropriate commit point (manual for passes, automatic for phases and frames)."]}),"\n",(0,a.jsx)(s.h3,{id:"why-three-buses",children:"Why Three Buses?"}),"\n",(0,a.jsx)(s.p,{children:"Consider collision detection and response:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"MAIN PHASE\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Pass 1: GridCollisionDetectionSystem                                \u2502\n\u2502   \u2192 Detects projectile-enemy collision                              \u2502\n\u2502   \u2192 pushPass<TriggerCollisionEvent>(...)                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 [Pass Commit Point]                                                 \u2502\n\u2502   \u2192 Pass events become readable                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Pass 2: ProjectileCollisionSystem                                   \u2502\n\u2502   \u2192 for (auto& evt : readPass<TriggerCollisionEvent>())             \u2502\n\u2502   \u2192 Pushes DespawnCommand for projectile                            \u2502\n\u2502   \u2192 Pushes DamageCommand for enemy                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsxs)(s.p,{children:["With ",(0,a.jsx)(s.code,{children:"pushPass()"}),", the collision event is visible ",(0,a.jsx)(s.strong,{children:"within the same phase"}),". We do not need to wait for the next frame. Instead, it's scoped to the phase, so it doesn't pollute other phases and allows for generating commands that can be executed in the next phase: ",(0,a.jsx)(s.code,{children:"pushPhase()"})," enables cross-phase communication (e.g., Pre phase schedules spawns, Main phase reads spawn confirmations), and ",(0,a.jsx)(s.code,{children:"pushFrame()"})," handles true cross-frame scenarios like audio triggers."]}),"\n",(0,a.jsx)(s.h2,{id:"fine-grained-control-with-commoit-points",children:"Fine-Grained Control with Commoit-Points"}),"\n",(0,a.jsxs)(s.p,{children:["The key innovation is the ",(0,a.jsx)(s.strong,{children:"Commit Point"}),". A pass can declare a commit point, which triggers:"]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Pass event bus swap \u2192 events become readable in the same phase"}),"\n",(0,a.jsx)(s.li,{children:"(Optionally) Structural commit \u2192 commands execute immediately (\u2192 Managers in next pass process Commands)"}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-cpp",children:"gameLoop.phase(PhaseType::Pre)\n    .addPass()\n    .addSystem<TwinStickInputSystem>(*playerGameObject)\n    .addCommitPoint(CommitPoint::Structural)  // Move-Commands execute HERE\n\n    .addPass()\n    .addSystem<GameObjectSpawnSystem>(spawnSchedulers)\n    .addCommitPoint(CommitPoint::Structural)  // New entities active, pass to CommandBuffer\n                                              // so the underlying SpawnManager can create them\n\n    .addPass()\n    .addSystem<Move2DSystem>();  // Operates on ALL entities\n"})}),"\n",(0,a.jsxs)(s.p,{children:["The ",(0,a.jsx)(s.code,{children:"CommitPoint::Structural"})," variant flushes the CommandBuffer at that point, enabling newly spawned entities to participate in subsequent passes within the same phase."]}),"\n",(0,a.jsx)(s.h2,{id:"the-refined-phase-commit",children:"The Refined Phase Commit"}),"\n",(0,a.jsx)(s.p,{children:"At each phase boundary, the following sequence occurs:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-cpp",children:"// After each phase completes\nphaseEventBus.swapBuffers();    // Phase events become readable\npassEventBus.clearAll();         // Pass events are cleared\ncommandBuffer.flush();           // Commands execute (mutations)\ngameWorld.flushManagers();       // Managers process queued requests\n\n// Additionally, at the end of Post phase:\nframeEventBus.swapBuffers();     // Frame events readable in next frame\n"})}),"\n",(0,a.jsxs)(s.p,{children:["This is the evolved version of the original ",(0,a.jsx)(s.code,{children:"flush()"})," sequence, now contextualized within phases."]}),"\n",(0,a.jsx)(s.h2,{id:"complete-frame-execution",children:"Complete Frame Execution"}),"\n",(0,a.jsx)(s.p,{children:"Here's how a complete frame flows:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-cpp",children:"for (phase : {Pre, Main, Post}) {\n\n    for (pass : phase.passes()) {\n        for (system : pass.systems()) {\n            system.update(updateContext);\n            // Systems can:\n            // - pushPass<E>() for same-phase communication\n            // - pushPhase<E>() for next-phase communication\n            // - pushFrame<E>() for next-frame communication\n            // - readPass<E>() for events from previous passes\n            // - readPhase<E>() for events from previous phase\n            // - readFrame<E>() for events from previous frame\n        }\n\n        if (pass.commitPoint() == CommitPoint::PassEvents) {\n            passEventBus.swapBuffers();  // Pass events readable\n        }\n\n        if (pass.commitPoint() == CommitPoint::Structural) {\n            passEventBus.swapBuffers();\n            commandBuffer.flush();        // Immediate mutation\n            gameWorld.flushManagers();\n        }\n    }\n\n    // Phase Commit\n    phaseEventBus.swapBuffers();    // Phase events readable\n    passEventBus.clearAll();         // Clear pass events\n    commandBuffer.flush();           // Execute commands\n    gameWorld.flushManagers();       // Process manager queues\n\n    if (phase == Post) {\n        frameEventBus.swapBuffers(); // Frame events readable next frame\n    }\n}\n\nrender();\n"})}),"\n",(0,a.jsx)(s.h2,{id:"practical-example-spawning-a-projectile",children:"Practical Example: Spawning a Projectile"}),"\n",(0,a.jsx)(s.p,{children:"Let's trace through shooting a projectile:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"Frame N\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nPRE PHASE\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Pass 1: TwinStickInputSystem                                        \u2502\n\u2502   \u2192 Player presses fire button                                      \u2502\n\u2502   \u2192 Pushes ShootCommand to CommandBuffer                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 [Commit Point: Structural]                                          \u2502\n\u2502   \u2192 CommandBuffer.flush() executes ShootCommand                     \u2502\n\u2502   \u2192 SpawnManager creates projectile from pool                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Pass 2: GameObjectSpawnSystem                                       \u2502\n\u2502   \u2192 Evaluates spawn rules, schedules enemy spawns                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 [Commit Point: Structural]                                          \u2502\n\u2502   \u2192 New enemies spawned and activated                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Pass 3: Move2DSystem, SteeringSystem                                \u2502\n\u2502   \u2192 All entities (including new projectile) move                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsxs)(s.p,{children:["The projectile exists and moves ",(0,a.jsx)(s.strong,{children:"in the same frame"})," it was spawned. In the original architecture, it would have been invisible until frame N+1."]}),"\n",(0,a.jsx)(s.h2,{id:"key-improvements-over-the-original-design",children:"Key Improvements Over the Original Design"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Aspect"}),(0,a.jsx)(s.th,{children:"Original"}),(0,a.jsx)(s.th,{children:"Phase/Pass"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Event visibility"}),(0,a.jsx)(s.td,{children:"Next frame only"}),(0,a.jsx)(s.td,{children:"Same phase (pass) or next phase"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Command execution"}),(0,a.jsx)(s.td,{children:"Once per frame"}),(0,a.jsx)(s.td,{children:"At commit points + phase boundaries"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Structural changes"}),(0,a.jsx)(s.td,{children:"Wait for next frame"}),(0,a.jsx)(s.td,{children:"Immediate within phase"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Event scope"}),(0,a.jsx)(s.td,{children:"Global"}),(0,a.jsx)(s.td,{children:"Pass / Phase / Frame"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Complexity"}),(0,a.jsx)(s.td,{children:"Simple"}),(0,a.jsx)(s.td,{children:"More setup, more control"})]})]})]}),"\n",(0,a.jsx)(s.h2,{id:"when-to-use-what",children:"When to Use What"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Scenario"}),(0,a.jsx)(s.th,{children:"Use"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Collision \u2192 Damage response"}),(0,a.jsxs)(s.td,{children:[(0,a.jsx)(s.code,{children:"pushPass()"})," + Commit Point"]})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Spawn request \u2192 Spawn confirmation"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"pushPhase()"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Audio trigger for next frame"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"pushFrame()"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Immediate entity creation"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"addCommitPoint(CommitPoint::Structural)"})})]})]})]}),"\n",(0,a.jsx)(s.h2,{id:"related-works",children:"Related works"}),"\n",(0,a.jsxs)(s.p,{children:["Of ourse, this Phase/Pass architecture didn\u2019t appear out of thin air. It\u2019s shaped by scheduling and deferred commit patterns that have proven themselves in other ECS-driven runtimes. Unity DOTS, for example, structures execution into system groups and uses explicit EntityCommandBuffer playback points to apply structural changes at well-defined times (",(0,a.jsx)(s.a,{href:"https://docs.unity3d.com/Packages/com.unity.entities@6.5/manual/systems-entity-command-buffers.html",children:"Unity Entities: ECB playback"}),"). Bevy follows a similar philosophy with schedules and an explicit ",(0,a.jsx)(s.code,{children:"ApplyDeferred"})," barrier that tells the executor when to apply buffered commands (like ",(0,a.jsx)(s.code,{children:"Commands"}),") (",(0,a.jsx)(s.a,{href:"https://docs.rs/bevy/latest/bevy/ecs/schedule/struct.ApplyDeferred.html",children:"Bevy: ApplyDeferred"}),'). Flecs takes yet another angle on the same idea: Systems often run in a "readonly" mode where structural changes are deferred and later merged, preserving iteration safety and keeping mutation timing explicit (',(0,a.jsx)(s.a,{href:"https://www.flecs.dev/flecs/md_docs_2Manual.html#deferred-operations",children:"Flecs: Systems / readonly & deferred ops"}),'). helios leans into this family of approaches, but makes the commit semantics first-class: Pass/phase/frame scopes are explicit APIs, and commit points turn "when does this become visible?" from an implicit convention into a rule you can point at in code.']}),"\n",(0,a.jsx)(s.h2,{id:"looking-forward",children:"Looking Forward"}),"\n",(0,a.jsx)(s.p,{children:"The Phase/Pass architecture has proven flexible enough to handle increasingly complex game logic while maintaining determinism. The explicit commit points make it clear when state changes occur, which aids debugging and reasoning about system interactions."}),"\n",(0,a.jsxs)(s.p,{children:["I have already started to migrate the underlying systems to a real ECS architecture. The next step is to seal development on the current game demo and start working on the follow up to ",(0,a.jsx)(s.a,{href:"https://garagecraft.games/devlog/2025/11/10/helios-design-and-prototypical-implementation-of-a-cpp-game-framework",children:"the paper on the prototype"}),"."]})]})}function c(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},7192:e=>{e.exports=JSON.parse('{"permalink":"/devlog/2026-02-10-phase-pass-architecture/","source":"@site/devlog/2026-02-10-gameloop-phase-pass-architecture/index.mdx","title":"Phase/Pass Architecture: Evolution of the Game Loop","description":"A follow-up to the game loop architecture post, introducing the refined Phase/Pass structure. This post explores how helios now organizes the game loop into phases with granular passes, enabling fine-grained control over event propagation and command execution timing.","date":"2026-02-10T00:00:00.000Z","tags":[{"inline":false,"label":"DevLog","permalink":"/devlog/tags/devlog","description":"Development log entries documenting the journey of building helios and garagecraft games"},{"inline":false,"label":"helios","permalink":"/devlog/tags/helios","description":"Posts about the helios C++23 game framework - architecture, implementation, and technical deep dives"},{"inline":true,"label":"architecture","permalink":"/devlog/tags/architecture"},{"inline":true,"label":"game-loop","permalink":"/devlog/tags/game-loop"},{"inline":true,"label":"events","permalink":"/devlog/tags/events"},{"inline":true,"label":"commands","permalink":"/devlog/tags/commands"},{"inline":true,"label":"phase-pass","permalink":"/devlog/tags/phase-pass"},{"inline":true,"label":"double-buffering","permalink":"/devlog/tags/double-buffering"},{"inline":true,"label":"data-oriented-design","permalink":"/devlog/tags/data-oriented-design"}],"readingTime":6.21,"hasTruncateMarker":true,"authors":[{"name":"Thorsten Suckow-Homberg","url":"https://thorsten.suckow-homberg.de","imageURL":"https://avatars.githubusercontent.com/u/823135","key":"thorstensuckow","page":null}],"frontMatter":{"title":"Phase/Pass Architecture: Evolution of the Game Loop","description":"A follow-up to the game loop architecture post, introducing the refined Phase/Pass structure. This post explores how helios now organizes the game loop into phases with granular passes, enabling fine-grained control over event propagation and command execution timing.","date":"2026-02-10","slug":"/2026-02-10-phase-pass-architecture/","tags":["devlog","helios","architecture","game-loop","events","commands","phase-pass","double-buffering","data-oriented-design"],"keywords":["cpp","game engine","architecture","command pattern","event bus","phase","pass","commit point","determinism","frame lifecycle"],"authors":["thorstensuckow"]},"unlisted":false,"nextItem":{"title":"helios - A High-Level Overview of the Game Loop Architecture","permalink":"/devlog/2026-01-05-high-level-overview-of-the-game-loop-architecture/"}}')},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>o});var t=n(6540);const a={},i=t.createContext(a);function r(e){const s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);